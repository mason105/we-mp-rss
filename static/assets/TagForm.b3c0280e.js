import{_ as j,d as q,u as G,s as O,r as i,k as P,e as x,f as C,c as u,v as V,w as t,F as L,n as W,M as r,j as s,o as b,l as H,m as F,x as K}from"./index.65e92f72.js";import{g as Q,u as X,a as Y,c as Z}from"./tagManagement.84fa5adb.js";const ee={class:"tag-form"},ue={class:"cover-upload"},ae=["src"],te={class:"upload-mask"},oe=q({__name:"TagForm",setup(le){const E=G(),g=O(),p=i(!1),B=i(!1),y=i(!1),a=i({name:"",cover:null,intro:null,status:1,mps_id:[]}),w={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u7B7E\u540D\u79F0"}]},A=async l=>{try{B.value=!0;const e=await Q(l);a.value={...e,mps_id:JSON.parse(e.mps_id||[])},W(()=>{D.value&&D.value.parseSelected(a.value.mps_id)})}catch{r.error("\u83B7\u53D6\u6807\u7B7E\u8BE6\u60C5\u5931\u8D25")}finally{B.value=!1}},S=async l=>{var c,m,n,f;const e=((c=l.fileItem)==null?void 0:c.file)||l.file;if(!((m=e==null?void 0:e.type)!=null&&m.startsWith("image/"))){r.error("\u8BF7\u9009\u62E9\u56FE\u7247\u6587\u4EF6 (JPEG/PNG)");return}if(e.size>2*1024*1024){r.error("\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC72MB");return}try{const d=await X(e);a.value.cover=d.avatar}catch(d){console.error("\u4E0A\u4F20\u9519\u8BEF:",d),r.error(`\u4E0A\u4F20\u5931\u8D25: ${((f=(n=d.response)==null?void 0:n.data)==null?void 0:f.message)||d.message||"\u670D\u52A1\u5668\u9519\u8BEF"}`)}return!1},T=()=>{r.warning("\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u5C01\u9762\u6587\u4EF6")},M=l=>{r.error(`\u4E0A\u4F20\u51FA\u9519: ${l.message||"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}`)},_=i(!1),D=i(null),U=l=>{const e=l.target;e.src="/default-cover.png"},h=async()=>{try{y.value=!0;const l={...a.value,mps_id:JSON.stringify(a.value.mps_id)};p.value?(await Y(E.params.id,l),r.success("\u66F4\u65B0\u6210\u529F")):(await Z(l),r.success("\u521B\u5EFA\u6210\u529F")),g.push("/tags")}catch{r.error(p.value?"\u66F4\u65B0\u5931\u8D25":"\u521B\u5EFA\u5931\u8D25")}finally{y.value=!1}};return P(()=>{E.params.id&&(p.value=!0,A(E.params.id))}),(l,e)=>{const c=s("a-page-header"),m=s("a-input"),n=s("a-form-item"),f=s("icon-image"),d=s("icon-edit"),N=s("a-upload"),$=s("a-textarea"),R=s("a-switch"),v=s("a-button"),k=s("a-space"),z=s("a-form"),I=s("a-card"),J=s("a-modal");return b(),x(L,null,[C("div",ee,[u(c,{title:p.value?"\u7F16\u8F91\u6807\u7B7E":"\u6DFB\u52A0\u6807\u7B7E",subtitle:"\u6807\u7B7E\u4FE1\u606F",onBack:e[0]||(e[0]=o=>V(g).go(-1))},null,8,["title"]),u(I,{loading:B.value},{default:t(()=>[u(z,{model:a.value,rules:w,layout:"vertical",onSubmit:h},{default:t(()=>[u(n,{label:"\u6807\u7B7E\u540D\u79F0",field:"name"},{default:t(()=>[u(m,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.name=o),placeholder:"\u8BF7\u8F93\u5165\u6807\u7B7E\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(n,{label:"\u5C01\u9762\u56FE",field:"cover"},{default:t(()=>[u(N,{"custom-request":S,"show-file-list":!1,accept:"image/*",limit:1,"max-size":2048,onExceed:T,onError:M},{"upload-button":t(()=>[C("div",ue,[a.value.cover?(b(),x("img",{key:0,src:a.value.cover,alt:"cover",onError:U},null,40,ae)):(b(),H(f,{key:1})),C("div",te,[u(d)])])]),_:1})]),_:1}),u(n,{label:"\u7B80\u4ECB",field:"intro"},{default:t(()=>[u($,{modelValue:a.value.intro,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.intro=o),placeholder:"\u8BF7\u8F93\u5165\u6807\u7B7E\u7B80\u4ECB","auto-size":{minRows:3}},null,8,["modelValue"])]),_:1}),u(n,{label:"\u72B6\u6001",field:"status"},{default:t(()=>[u(R,{modelValue:a.value.status,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.status=o),"checked-value":1,"unchecked-value":0},null,8,["modelValue"])]),_:1}),u(n,{label:"\u516C\u4F17\u53F7",field:"mps_id"},{default:t(()=>[u(k,null,{default:t(()=>[u(m,{"model-value":(a.value.mps_id||[]).map(o=>o.id.toString()).join(","),placeholder:"\u8BF7\u9009\u62E9\u516C\u4F17\u53F7",readonly:"",style:{width:"300px"}},null,8,["model-value"]),u(v,{onClick:e[4]||(e[4]=o=>_.value=!0)},{default:t(()=>e[9]||(e[9]=[F("\u9009\u62E9")])),_:1,__:[9]})]),_:1})]),_:1}),u(n,null,{default:t(()=>[u(k,null,{default:t(()=>[u(v,{type:"primary","html-type":"submit",loading:y.value},{default:t(()=>e[10]||(e[10]=[F(" \u63D0\u4EA4 ")])),_:1,__:[10]},8,["loading"]),u(v,{onClick:e[5]||(e[5]=o=>V(g).go(-1))},{default:t(()=>e[11]||(e[11]=[F("\u53D6\u6D88")])),_:1,__:[11]})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["loading"])]),u(J,{visible:_.value,"onUpdate:visible":e[8]||(e[8]=o=>_.value=o),title:"\u9009\u62E9\u516C\u4F17\u53F7",footer:!1,width:"800px"},{footer:t(()=>[u(v,{type:"primary",onClick:e[7]||(e[7]=o=>_.value=!1)},{default:t(()=>e[12]||(e[12]=[F("\u786E\u5B9A")])),_:1,__:[12]})]),default:t(()=>[u(K,{ref_key:"mpSelectorRef",ref:D,modelValue:a.value.mps_id,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.mps_id=o)},null,8,["modelValue"])]),_:1},8,["visible"])],64)}}});var re=j(oe,[["__scopeId","data-v-beea59e2"]]);export{re as default};
